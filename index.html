<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Online Store</title>
  <style>
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .product-card {
      border: 1px solid #ddd;
      padding: 15px;
      text-align: center;
      border-radius: 8px;
      transition: transform 0.2s;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .product-card img {
      max-width: 100%;
      height: auto;
      margin-bottom: 10px;
    }

    .product-card a {
      text-decoration: none;
      color: inherit;
    }

    .filter-section {
      padding: 20px;
      background: #f5f5f5;
      display: flex;
      gap: 20px;
      align-items: center;
    }

    select {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }

    .add-to-cart {
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }

    .add-to-cart:hover {
      background-color: #45a049;
    }

    nav {
      padding: 15px;
      background-color: #333;
      color: white;
    }

    nav a {
      color: white;
      text-decoration: none;
      margin-right: 20px;
    }
  </style>
</head>

<body>
  <nav>
    <a href="index.html">Products</a>
    <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
  </nav>

  <div class="filter-section">
    <div class="filter-group">
      <label for="category-filter">Category:</label>
      <select id="category-filter">
        <option value="">All Categories</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="sort-by">Sort by:</label>
      <select id="sort-by">
        <option value="">None</option>
        <option value="price">Price</option>
        <option value="name">Name</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="sort-order">Order:</label>
      <select id="sort-order">
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
      </select>
    </div>
  </div>

  <div class="product-grid" id="products-container"></div>

  <script>
    const API_URL = "http://localhost:3000/api";

    async function loadProducts() {
      const categoryFilter = document.getElementById("category-filter").value;
      const sortBy = document.getElementById("sort-by").value;
      const sortOrder = document.getElementById("sort-order").value;

      const params = new URLSearchParams();
      if (categoryFilter) params.append("category", categoryFilter);
      if (sortBy) {
        params.append("sortBy", sortBy);
        params.append("order", sortOrder);
      }

      const url = `${API_URL}/products${params.toString() ? "?" + params.toString() : ""
        }`;

      try {
        const response = await fetch(url);
        const products = await response.json();

        const container = document.getElementById("products-container");
        container.innerHTML = products
          .map(
            (product) => `
                    <div class="product-card">
                        <a href="product.html?id=${product._id}">
                            <img src="${product.image || "/placeholder.jpg"}" alt="${product.name}">
                            <h3>${product.name}</h3>
                            <p>$${product.price.toFixed(2)}</p>
                        </a>
                        <button class="add-to-cart" onclick='addToCart(${JSON.stringify(product)})'>
                            Add to Cart
                        </button>
                    </div>
                `
          )
          .join("");
      } catch (error) {
        console.error("Error loading products:", error);
      }
    }

    function addToCart(product) {
      let cart = JSON.parse(localStorage.getItem("cart") || "[]");

      const existingItemIndex = cart.findIndex(
        (item) => item.product._id === product._id
      );

      if (existingItemIndex !== -1) {
        cart[existingItemIndex].quantity += 1;
      } else {
        cart.push({
          product: product,
          quantity: 1
        });
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      //alert("Product added to cart!");
    }

    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById("cart-count").textContent = totalItems;
    }

    async function loadCategories() {
      try {
        const response = await fetch(`${API_URL}/categories`);
        const categories = await response.json();

        const select = document.getElementById("category-filter");
        categories.forEach((category) => {
          const option = document.createElement("option");
          option.value = category._id;
          option.textContent = category.name;
          select.appendChild(option);
        });
      } catch (error) {
        console.error("Error loading categories:", error);
      }
    }

    document
      .getElementById("category-filter")
      .addEventListener("change", loadProducts);
    document
      .getElementById("sort-by")
      .addEventListener("change", loadProducts);
    document
      .getElementById("sort-order")
      .addEventListener("change", loadProducts);

    document.addEventListener("DOMContentLoaded", () => {
      loadProducts();
      loadCategories();
      updateCartCount();
    });
  </script>
</body>

</html>