<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Product Details</title>
  <style>
    .product-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
    }

    .product-image {
      width: 100%;
      height: auto;
    }

    .product-info {
      padding: 20px;
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 20px 0;
    }

    .quantity-selector button {
      padding: 5px 10px;
      font-size: 1.2em;
    }

    .quantity-selector input {
      width: 60px;
      padding: 5px;
      text-align: center;
    }

    .add-to-cart {
      padding: 10px 20px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1.1em;
    }

    .add-to-cart:hover {
      background-color: #45a049;
    }

    nav {
      padding: 20px;
      background-color: #f8f9fa;
      margin-bottom: 20px;
    }

    nav a {
      margin-right: 20px;
      text-decoration: none;
      color: #333;
    }
  </style>
</head>

<body>
  <nav>
    <a href="index.html">Products</a>
    <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
  </nav>

  <div class="product-container" id="product-details">
    <!-- placeholder for product details -->
  </div>

  <script>
    const API_URL = "http://localhost:3000/api";

    async function loadProductDetails() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get("id");

        if (!productId) {
          window.location.href = "index.html";
          return;
        }

        const response = await fetch(`${API_URL}/products/${productId}`);
        const product = await response.json();

        document.title = `${product.name} - Product Details`;

        const container = document.getElementById("product-details");
        container.innerHTML = `
                    <div class="product-image-container">
                        <img src="${product.image || "/placeholder.jpg"}" alt="${product.name}" class="product-image">
                    </div>
                    <div class="product-info">
                        <h1>${product.name}</h1>
                        <p class="category">Category: ${product.category ? product.category.name : "Uncategorized"}</p>
                        <p class="description">${product.description}</p>
                        <p class="price">$${product.price.toFixed(2)}</p>
                        <div class="quantity-selector">
                            <button onclick="adjustQuantity(-1)">-</button>
                            <input type="number" id="quantity" value="1" min="1" max="99">
                            <button onclick="adjustQuantity(1)">+</button>
                        </div>
                        <button class="add-to-cart" onclick="addToCart(${JSON.stringify(product)})">
                            Add to Cart
                        </button>
                    </div>
                `;

        updateCartCount();
      } catch (error) {
        console.error("Error loading product details:", error);
      }
    }

    function adjustQuantity(change) {
      const quantityInput = document.getElementById("quantity");
      let newValue = parseInt(quantityInput.value) + change;
      newValue = Math.max(1, Math.min(99, newValue)); // Limit between 1 and 99
      quantityInput.value = newValue;
    }

    function addToCart(product) {
      const quantity = parseInt(document.getElementById("quantity").value);
      let cart = JSON.parse(localStorage.getItem("cart") || "[]");

      const existingProductIndex = cart.findIndex(
        (item) => item.product._id === product._id
      );

      if (existingProductIndex !== -1) {
        cart[existingProductIndex].quantity += quantity;
      } else {
        cart.push({
          product: product,
          quantity: quantity
        });
      }

      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();

      // alert(`Added ${quantity} ${product.name} to cart`);
    }

    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById("cart-count").textContent = totalItems;
    }

    document.addEventListener("DOMContentLoaded", loadProductDetails);
  </script>
</body>

</html>